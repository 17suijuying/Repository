<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>Love . ç¿æ™¨åš&èƒ¡ç¼é›…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --gap: 24px;
      --text-max: 900px;
      --content-max: 980px;         /* ç»Ÿä¸€å†…å®¹æœ€å¤§å®½åº¦ï¼ˆæ¡Œé¢ï¼‰ */
      --text-color:#111;
      --pink:#FF7AAE;
    }

    *{ box-sizing: border-box; }
    html{ overflow-y:auto; -webkit-text-size-adjust:100%; }
    body{
      margin:0; background:#fff; color:var(--text-color);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Noto Sans CJK SC","Microsoft YaHei", sans-serif;
      line-height:1.65;
      overflow-x:hidden;           /* é˜²æ¨ªå‘æ»šåŠ¨ */
    }

    main.page{ display:flex; flex-direction:column; gap:var(--gap); }

    /* ç»Ÿä¸€çš„å†…å®¹å®¹å™¨ï¼šå±…ä¸­ + ä¾§è¾¹è· */
    .block{
      width:min(100%, var(--content-max));
      margin:0 auto;
      padding:0 16px;              /* ä¸ä½ ä¹‹å‰ä¸€è‡´çš„å·¦å³å†…è¾¹è· */
    }

    figure{ margin:0; }

    /* å›¾ç‰‡å®¹å™¨éƒ½å¥—ä¸Š .blockï¼Œå›¾ç‰‡100%ç­‰æ¯” */
    .hero.block, .photo.block, .split.block, .countdown.block, .form-card.block{ }

    img{ display:block; max-width:100%; height:auto; }

    /* é¦–å›¾ï¼šé«˜åº¦å…‹åˆ¶ï¼Œä»ç„¶ç­‰æ¯”ï¼›ä¸å†å†³å®šå…¶ä»–å†…å®¹å®½åº¦ */
    .hero-img{
      width:100%;
      height:auto;
      max-height:50vh;             /* æ§é«˜é¿å…é¦–å±å¤ªå‹ */
      object-fit:contain;
      margin:0 auto;
    }

    /* æ–‡æ¡ˆåŒºå— */
    .kaipian, .yaoqing, .guanyu, .xianglian, .jiehun, .qingjian{
      width:min(100%, var(--text-max));
      margin:0 auto 48px;
      padding:0 16px;
      text-align:center;
      font-size:13px;
      line-height:1.7;
    }
    .kaipian p, .yaoqing p, .guanyu p, .xianglian p, .jiehun p, .qingjian p{ margin:.5em 0; }

    /* å±•ç¤ºå›¾ç‰‡ï¼ˆéé¦–å›¾ï¼‰ */
    .photo-img{
      width:100%;
      height:auto;
      object-fit:contain;
      margin:0 auto;
    }

    /* å·¦å³åˆ†æ  */
    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:24px;
      align-items:center;
      margin-bottom:48px;
    }
    .split-image{ display:flex; justify-content:center; }
    .split-text{
      text-align:center;
      line-height:1.7;
      font-size:13px;
      color:var(--text-color);
      padding:0 8px;
    }
    .split-text h3{
      margin:0 0 8px;
      font-weight:600;
      font-size:12px;              /* â€œè®¢å©šâ€å°æ ‡é¢˜ */
      opacity:.9;
    }
    .half-img{ width:100%; height:auto; }

    /* å€’è®¡æ—¶ */
    .countdown{
      margin:0 auto 48px;
      padding:18px 16px 20px;
      text-align:center;
      color:#3b2a2d;
      background:linear-gradient(180deg, #FFEAF1 0%, #FFD9E7 100%);
      border-radius:16px;
      box-shadow:0 6px 18px rgba(255,120,160,.12);
      overflow:hidden;             /* é˜²æº¢å‡ºä¿åº• */
    }
    .countdown h3{
      margin:0 0 10px; font-size:12px; font-weight:600; letter-spacing:.1em; color:#5d3b45;
    }
    .cd-grid{
      display:grid; 
      grid-template-columns:repeat(4, minmax(0,1fr));  /* é˜²åˆ—å®½æ’‘ç ´ */
      gap:12px; align-items:end; justify-items:center; margin:6px 0;
    }
    .cd-item{ min-width:52px; }    /* é€‚åº¦çš„æœ€å°å€¼ï¼Œåç»­åœ¨è¶…å°å±å†é™ */
    .cd-num{ font-weight:700; font-variant-numeric:tabular-nums; line-height:1.1; font-size:32px; }
    .cd-lbl{ margin-top:4px; font-size:12px; opacity:.85; display:block; }
    .cd-date{ margin-top:8px; font-size:12px; opacity:.9; }

    /* å¯¼èˆªå¡ç‰‡ */
    .nav-card{
      background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      padding:20px 16px; min-height:220px;
      display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;
    }
    .nav-card h4{ margin:0 0 6px; font-size:14px; font-weight:700; letter-spacing:.02em; }
    .nav-actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .nav-btn, .form-btn{
      display:inline-block; text-decoration:none; padding:10px 14px; border-radius:999px;
      background:var(--pink); color:#fff; font-size:14px; box-shadow:0 8px 18px rgba(255,122,174,.25);
      border:1px solid var(--pink); cursor:pointer;
    }
    .nav-btn:hover, .form-btn:hover{ filter:brightness(.98); }

    /* ç•™è¨€å¡ç‰‡ */
    .form-card{
      background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.06); padding:18px 16px 16px; text-align:center; margin-bottom:48px;
    }
    .form-card h4{ margin:0 0 8px; font-size:14px; font-weight:700; }
    .form-tip{ margin:8px 0 0; font-size:12px; opacity:.85; }
    .input, .textarea{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(0,0,0,.12);
      font-size:14px; outline:none;
    }
    .textarea{ resize:vertical; min-height:96px; }

    /* ç®¡ç†å‘˜æŸ¥çœ‹é¢æ¿ï¼ˆåˆ—è¡¨æ ·å¼ï¼‰ */
    .admin-list{ max-width:900px; margin:12px auto 0; text-align:left; }
    .admin-item{
      border:1px solid rgba(0,0,0,.08); border-radius:12px; padding:12px; margin:8px 0;
      box-shadow:0 4px 12px rgba(0,0,0,.06);
    }
    .admin-item h5{ margin:0 0 6px; font-size:14px; }
    .muted{ opacity:.7; font-size:12px; }

    /* éŸ³ä¹æŒ‰é’®ï¼ˆå›¾æ ‡ï¼‰ */
    #music-toggle{
      position:fixed; right:12px; bottom:12px; z-index:9999;
      width:44px; height:44px; display:grid; place-items:center;
      padding:0; border:0; border-radius:999px; background:#fff; box-shadow:0 4px 16px rgba(0,0,0,.15);
      font-size:16px; line-height:1; cursor:pointer;
    }
    #music-toggle[hidden]{ display:none; }

    /* ========= å¼¹å¹• ========= */
    #danmu-layer{
      position:fixed; left:0; top:12vh; width:100vw; height:36vh;
      pointer-events:none; overflow:hidden; z-index:999;
    }
    .dm{
      position:absolute; left:100vw; white-space:nowrap; color:var(--pink);
      font-weight:600; font-size:14px; line-height:1.2; text-shadow:0 1px 2px rgba(0,0,0,.06);
      background:transparent; padding:0; border:0; filter:none; will-change:transform;
      animation-name:dm-move; animation-timing-function:linear; animation-iteration-count:1;
    }
    @keyframes dm-move{
      0%{ transform:translateX(0); }
      100%{ transform:translateX(-120vw); }
    }
    #dm-toggle{
      position:fixed; right:64px; bottom:12px; z-index:9999;
      width:44px; height:44px; display:grid; place-items:center;
      padding:0; border:0; border-radius:999px; background:#fff; box-shadow:0 4px 16px rgba(0,0,0,.15);
      font-size:16px; line-height:1; cursor:pointer;
    }

    /* ========= ç§»åŠ¨ç«¯ä¼˜åŒ– ========= */
    @media (max-width:768px){
      .hero-img{ max-height:45svh; }

      /* è®¢å©šåˆ†åˆ—ï¼šç¼©å›¾ã€å‡é—´è·ã€é™å­—ä½“ï¼Œé¿å…æ˜¾å¾—æ›´å¤§ */
      .split{ grid-template-columns:1fr; gap:16px; }
      .split-image .half-img{ max-width:82%; margin:0 auto; }
      .split-text{ font-size:clamp(10px, 2.6vw, 12px); }
      .split-text h3{ font-size:clamp(10px, 2.2vw, 11px); }

      /* å€’è®¡æ—¶ï¼šæ”¶ç´§åˆ—å®½ä¸å­—å·ï¼Œç¡®ä¿ä¸æº¢å‡ºç²‰è‰²åº•å— */
      .cd-grid{ gap:10px; grid-template-columns:repeat(4, minmax(0,1fr)); }
      .cd-item{ min-width:48px; }
      .cd-num{ font-size:clamp(18px, 6vw, 26px); }
      .cd-lbl, .cd-date, .countdown h3{ font-size:clamp(10px, 2.8vw, 12px); }
      .form-card{ width:min(100%, var(--content-max)); }
    }

    /* è¶…å°å±ï¼ˆä¾‹å¦‚éƒ¨åˆ†å¾®ä¿¡WebViewæœºå‹ï¼‰è¿›ä¸€æ­¥æ”¶ç´§ */
    @media (max-width:380px){
      .split-image .half-img{ max-width:78%; }
      .cd-grid{ gap:8px; }
      .cd-item{ min-width:44px; }
      .cd-num{ font-size:22px; }
      .cd-lbl{ font-size:11px; }
    }

    /* ===== æ”¾å¤§é¦–å›¾ï¼šå¢åŠ å¯è§é«˜åº¦ï¼ˆæ¡Œé¢/ç§»åŠ¨ï¼‰ ===== */
    :root{
      /* åŸæ¥æ— æ­¤å˜é‡æ—¶å¯æ–°å¢ */
      --hero-max-h-desktop: 65vh; /* åŸ50vh â†’ 65vh æ›´é†’ç›® */
      --hero-max-h-mobile: 56svh; /* åŸ45svh â†’ 56svh æ›´é«˜ */
    }

    /* æ›¿æ¢åŸæ¥çš„ .hero-img é‡Œ max-height é‚£ä¸€è¡Œ */
    .hero-img{
      width:100%;
      height:auto;
      max-height: var(--hero-max-h-desktop);  /* â† ç”¨å˜é‡æ§åˆ¶ */
      object-fit: contain;
      margin: 0 auto;
    }

    /* ï¼ˆå¯é€‰ï¼‰å¦‚æœä½ å¸Œæœ›é¦–å›¾åœ¨æ¡Œé¢æ¯”å…¶ä»–å†…å®¹ç•¥å®½ä¸€ç‚¹ï¼Œè§£å¼€ä¸‹é¢æ³¨é‡Šï¼š
    .hero.block{ width: min(100%, calc(var(--content-max) + 120px)); padding: 0 8px; }
    */

    /* ===== æ‰‹æœºç«¯ç»†åŒ–ï¼šç¼©å°â€œè®¢å©šâ€åˆ†åˆ—ã€åŒæ—¶å¢é«˜é¦–å›¾ ===== */
    @media (max-width: 768px){
      .hero-img{ max-height: var(--hero-max-h-mobile); }

      /* åˆ†æ æ•´ä½“æ›´ç´§å‡‘ */
      .split{ grid-template-columns: 1fr; gap: 12px; }

      /* è®¢å©šå›¾ç‰‡å†å°ä¸€äº›ï¼ˆåŸ 82% â†’ 70%ï¼‰ */
      .split-image .half-img{ max-width: 70%; margin: 0 auto; }

      /* æ–‡å­—å†å°ä¸€ç‚¹ç‚¹ï¼Œé¿å…æ˜¾å¾—æ¯”å…¶å®ƒæ®µè½å¤§ */
      .split-text{ font-size: clamp(10px, 2.2vw, 11px); }
      .split-text h3{ font-size: clamp(9px, 2vw, 10px); }

      /* å€’è®¡æ—¶ä¿æŒç¨³å®šï¼ˆé˜²â€œç§’â€æº¢å‡ºï¼‰ */
      .cd-grid{ gap: 10px; grid-template-columns: repeat(4, minmax(0, 1fr)); }
      .cd-item{ min-width: 48px; }
      .cd-num{ font-size: clamp(18px, 6vw, 26px); }
      .cd-lbl, .cd-date, .countdown h3{ font-size: clamp(10px, 2.8vw, 12px); }
    }

    /* è¶…å°å±å†æ”¶ä¸€ç‚¹ï¼ˆä¾‹å¦‚éƒ¨åˆ†å¾®ä¿¡WebViewï¼‰ */
    @media (max-width: 380px){
      .split-image .half-img{ max-width: 66%; }     /* åŸ78%â†’66%ï¼Œæ›´ç¨³ */
      .cd-grid{ gap: 8px; }
      .cd-item{ min-width: 44px; }
      .cd-num{ font-size: 22px; }
      .cd-lbl{ font-size: 11px; }
    }
    
  </style>
</head>
<body>

  <main class="page" id="love-page">
    <!-- é¦–å›¾ -->
    <figure class="hero block">
      <img class="hero-img" id="heroImg" data-cdn-path="/images/shoutu.jpg" alt="é¦–å›¾">
    </figure>

    <section class="kaipian">
      <p>FOR YOU/ç»™æˆ‘æœ€äº²çˆ±çš„ä½ ä»¬</p>
      <p>å½“ä½ ä»¬çœ‹åˆ°è¿™äº›æ–‡å­—çš„æ—¶å€™</p>
      <p>å·²ç»è¢«æˆ‘ä»¬éƒ‘é‡åŠ å…¥åˆ°æˆ‘ä»¬çš„ INVITATION LIST</p>
      <p>å¦‚ä»Šæˆ‘ä»¬å†³å®šä»¥å¤«å¦»ä¹‹åç»­å†™æœªæ¥çš„äººç”Ÿ</p>
      <p>æˆ‘ä»¬ç›¸æ‹åœ¨ 2018 å¹´çš„å¤æœ«</p>
      <p>ä¸€è·¯èµ°æ¥çš„é…¸ç”œè‹¦è¾£ç»„æˆäº†æˆ‘ä»¬çš„æ•…äº‹</p>
    </section>

    <!-- å›¾ç‰‡ä¸æ–‡æ¡ˆ -->
    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/zhuanjitu.jpg" alt="è½¬çºªå›¾" loading="lazy" decoding="async">
    </figure>

    <section class="yaoqing">
      <p>â€œè¯šæŒšé‚€è¯·æ‚¨æ¥å‚åŠ å©šç¤¼â€</p>
      <p>â€œè§è¯è¿™åœºå› çˆ±è€Œç”Ÿçš„ç»“åˆâ€</p>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/guanyuwomen.jpg" alt="å…³äºæˆ‘ä»¬" loading="lazy" decoding="async">
    </figure>

    <section class="guanyu">
      <p>æ•…äº‹å¼€å§‹åœ¨2015å¹´çš„å¤å¤©</p>
      <p>é«˜äºŒçš„æˆ‘ä»¬æ¢åˆ°äº†åŒä¸€ä¸ªç­çº§</p>
      <p>åŒå­¦ æ˜¯æˆ‘ä»¬ä¹‹é—´çš„ç¬¬ä¸€ä¸ªèº«ä»½</p>
      <p>å°è±¡é‡Œ ä»–å¥½åƒæœ‰å¼ºè¿«ç—‡ ä½œä¸šå·¥å·¥æ•´æ•´ æ¡Œé¢å¹²å¹²å‡€å‡€</p>
      <p>å°è±¡é‡Œ å¥¹å‹¤å¥‹å¥½å­¦ ä½†çœ¼ç¥ä¸­åˆé€éœ²ç€æ¸…æ¾ˆçš„â€œå¤©çœŸâ€</p>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/haimatichenshan.jpg" alt="æµ·é©¬ä½“è¡¬è¡«" loading="lazy" decoding="async">
    </figure>

    <section class="xianglian">
      <p>èµ·åˆä¸€äººåœ¨æ­å· ä¸€äººåœ¨ä¸Šæµ·</p>
      <p>ä»å°å’Œå±±åˆ°é‡é©¬æµœ</p>
      <p>åšåšçš„è½¦ç¥¨è¿ç»“èµ·ä¸¤é¢—ç‚½çƒ­çš„å¿ƒ</p>
      <p>åœ¨å¤§å¤§çš„åŸå¸‚é‡Œç•™ä¸‹äº†ä¸¤äººçš„å°å°è¶³è¿¹</p>
      <p> </p>
      <p>åæ¥</p>
      <p>ä¸€äººåœ¨æ­å·å¿µä¹¦</p>
      <p>ä¸€äººå›æ¸©å·å·¥ä½œ</p>
      <p>åœ¨å¿™ç¢Œçš„ç”Ÿæ´»ä¸­</p>
      <p>æ¯ä¸ªå‘¨æœ«çš„çŸ­æš‚ç›¸é€¢æ‰¿è½½äº†ç®€å•çš„å¹¸ç¦ä¸å¯¹æœªæ¥çš„æ‰¿è¯º</p>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/xiaoqunzihunshazhao.jpg" alt="å°è£™å­å©šçº±ç…§" loading="lazy" decoding="async">
    </figure>

    <!-- å·¦å›¾å³æ–‡ -->
    <section class="split block">
      <div class="split-image">
        <img class="half-img" data-cdn-path="/images/dinghunzhao.jpg" alt="è®¢å©šç…§ç‰‡" loading="lazy" decoding="async">
      </div>
      <div class="split-text">
        <h3>&lt; è®¢å©š &gt;</h3>
        <p>2025å¹´2æœˆ15æ—¥</p>
        <p>æˆ‘ä»¬åœ¨åŒæ–¹å®¶äººçš„è§è¯ä¸‹ç¼”ç»“å©šçº¦</p>
        <p>æ‰€è°“è®¢å©š</p>
        <p>æ˜¯ä¸€ç”Ÿç›¸çŸ¥ç›¸å®ˆçš„çº¦å®š</p>
        <p>æ„¿æˆ‘ä»¬æˆä¸ºå½¼æ­¤ä½™ç”Ÿçš„ä¾é </p>
      </div>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/hunli.jpg" alt="å©šç¤¼" loading="lazy" decoding="async">
    </figure>

    <section class="jiehun">
      <p>ä»â€œå­¦ç”Ÿè¯â€åˆ°â€œç»“å©šè¯â€</p>
      <p>é‚£ä¸ªç‚½çƒ­çš„å¤å¤©åœ¨ä»Šå²åˆå†¬è¿æ¥ç»­é›†</p>
      <p>ç»ˆäºåœ¨2025å¹´12æœˆ10æ—¥æˆ‘ä»¬å†³å®šä¸¾åŠå©šç¤¼</p>
      <p>16å²è®¤è¯†ä½ ï¼Œ26å²å«ç»™ä½ </p>
      <p>å¾ˆå¹¸è¿å¯ä»¥ä¸ä½ æºæ‰‹åº¦è¿‡ä¸€ä¸ªåˆä¸€ä¸ªåå¹´</p>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/haimati.jpg" alt="æµ·é©¬ä½“" loading="lazy" decoding="async">
    </figure>

    <section class="qingjian">
      <p>åœ¨æˆ‘ä»¬æ— æ¯”é‡è¦çš„ä¸€å¤© æºåŒæˆ‘ä»¬çš„çˆ¶æ¯</p>
      <p>è¯šæŒšçš„é‚€è¯·æ‚¨å‡ºå¸­æˆ‘ä»¬çš„å©šç¤¼</p>
      <p>äººç”Ÿä¸€å…±ä¸‰ä¸‡å¤šå¤© å¾ˆè£å¹¸è¿™ä¸€å¤©</p>
      <p>æ‚¨èƒ½ä¸“ç¨‹ä¸ºæˆ‘ä»¬è€Œæ¥ ä¸æˆ‘ä»¬å…±åŒåˆ†äº« è§è¯è¿™ç¾å¥½æ—¶åˆ»</p>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/zhongshihunshazhao.jpg" alt="ä¸­å¼å©šçº±ç…§" loading="lazy" decoding="async">
    </figure>

    <section class="qingjian">
      <p>2025å¹´12æœˆ10æ—¥ æ˜ŸæœŸä¸‰</p>
      <p>å†œå†åæœˆå»¿ä¸€ 18:00</p>
    </section>

    <!-- å€’è®¡æ—¶ -->
    <section class="countdown block" id="countdown" data-deadline="2025-12-10T18:00:00">
      <div class="cd-grid" aria-live="polite">
        <div class="cd-item"><span class="cd-num" id="cd-days">00</span><span class="cd-lbl">å¤©</span></div>
        <div class="cd-item"><span class="cd-num" id="cd-hours">00</span><span class="cd-lbl">å°æ—¶</span></div>
        <div class="cd-item"><span class="cd-num" id="cd-mins">00</span><span class="cd-lbl">åˆ†é’Ÿ</span></div>
        <div class="cd-item"><span class="cd-num" id="cd-secs">00</span><span class="cd-lbl">ç§’</span></div>
      </div>
    </section>

    <!-- å¯¼èˆª + æ—¶é—´è¡¨ -->
    <section class="split block">
      <div class="split-text">
        <div class="nav-card">
          <h4>å©šç¤¼é…’åº—å¯¼èˆª</h4>
          <div class="nav-actions">
            <a class="nav-btn" target="_blank" rel="noopener"
               href="https://uri.amap.com/marker?position=120.6225,27.9637&name=%E5%A9%9A%E7%A4%BC%E9%85%92%E5%BA%97%28%E4%BE%8B%29&callnative=1">æŸ¥çœ‹åœ°å›¾</a>
            <a class="nav-btn" target="_blank" rel="noopener"
               href="https://uri.amap.com/navigation?to=120.6225,27.9637,%E5%A9%9A%E7%A4%BC%E9%85%92%E5%BA%97%28%E4%BE%8B%29&mode=car&callnative=1">æ‰“å¼€é«˜å¾·å¯¼èˆª</a>
          </div>
        </div>
      </div>
      <div class="split-image">
        <img class="half-img" data-cdn-path="/images/hunlishijianbiao.jpg" alt="å©šç¤¼æ—¶é—´è¡¨" loading="lazy" decoding="async">
      </div>
    </section>

    <section class="qingjian">
      <p>æ¸©å·åŸä¸­å¸Œå°”é¡¿é…’åº— ä¸€æ¥¼å¤©é•¿åœ°ä¹…A+Bå…</p>
      <p>æ¸©å·å¸‚ç“¯æµ·åŒºç“¯æµ·å¤§é“969å·</p>
    </section>

    <figure class="photo block">
      <img class="photo-img" data-cdn-path="/images/hunlijian.jpg" alt="å©šç¤¼è§" loading="lazy" decoding="async">
    </figure>

    <!-- ç•™è¨€æ¿ï¼ˆç›´è¿ä½ çš„åç«¯ /api/rsvp/* ï¼‰ -->
    <section class="form-card block" id="rsvp">
      <h4>ç•™è¨€æ¿ Â· RSVP</h4>
      <p class="form-tip">è¯·å¡«å†™ <strong>å§“å / äººæ•° / ç•™è¨€</strong> å¹¶æäº¤ã€‚æäº¤åä¼šåœ¨ä¸‹æ–¹æ˜¾ç¤ºã€‚</p>

      <form id="rsvp-form" style="max-width:600px;margin:0 auto;display:grid;grid-template-columns:1fr 120px;gap:10px;">
        <input id="rsvp-name" type="text" placeholder="å§“åï¼ˆå¿…å¡«ï¼‰" required
               class="input" style="grid-column:1 / span 2;">
        <input id="rsvp-count" type="number" min="1" step="1" placeholder="äººæ•°ï¼ˆå¿…å¡«ï¼‰" required
               class="input">
        <button class="form-btn" type="submit" style="height:42px;">æäº¤</button>
        <textarea id="rsvp-msg" rows="3" placeholder="ç•™è¨€ï¼ˆå¯é€‰ï¼‰" class="textarea" style="grid-column:1 / span 2;"></textarea>
      </form>

      <div id="rsvp-status" style="margin-top:10px;font-size:12px;opacity:.85;"></div>

      <div style="max-width:720px;margin:16px auto 0;">
        <ul id="rsvp-list" style="list-style:none;padding:0;margin:0;display:grid;gap:10px;"></ul>
      </div>
    </section>
  </main>

  <!-- å¼¹å¹•å±‚ + æŒ‰é’® -->
  <div id="danmu-layer" aria-hidden="true"></div>
  <button id="dm-toggle" aria-label="å¼¹å¹•å¼€å…³">ğŸ’¬</button>

  <!-- èƒŒæ™¯éŸ³ä¹ -->
  <audio id="bgm" src="music/è¾¾å°”æ–‡.mp3" preload="auto" loop></audio>
  <button id="music-toggle" hidden aria-label="æ’­æ”¾æˆ–æš‚åœ">â–¶</button>

  <script>
  (function () {
    /* ========= CDNå›é€€åŠ è½½ GitHub å›¾ç‰‡ ========= */
    const GH_USER="17suijuying";
    const GH_REPO="Repository";
    const GH_BRANCH="main";
    const CDN_HOSTS=[
      `https://cdn.jsdelivr.net/gh/${GH_USER}/${GH_REPO}@${GH_BRANCH}`,
      `https://fastly.jsdelivr.net/gh/${GH_USER}/${GH_REPO}@${GH_BRANCH}`,
      `https://gcore.jsdelivr.net/gh/${GH_USER}/${GH_REPO}@${GH_BRANCH}`,
    ];
    function attachImgFallback(img, path){
      let i=0;
      const tryNext=()=>{ if(i>=CDN_HOSTS.length) return; img.src=CDN_HOSTS[i++]+path; };
      img.addEventListener('error', tryNext, {once:false});
      tryNext();
    }
    document.querySelectorAll('img[data-cdn-path]').forEach(img=>{
      const p=img.getAttribute('data-cdn-path'); if(p) attachImgFallback(img,p);
    });

    /* ========= éŸ³ä¹æ’­æ”¾ï¼ˆå«å¾®ä¿¡ç¯å¢ƒè§£é”ï¼‰ ========= */
    const audio=document.getElementById('bgm');
    const musicBtn=document.getElementById('music-toggle');
    function syncMusicBtn(){ musicBtn.textContent = audio.paused ? 'â–¶' : 'â¸'; }
    function showMusicBtn(){ if(musicBtn.hidden) musicBtn.hidden=false; syncMusicBtn(); }
    async function tryAutoplaySilently(){ try{ audio.muted=true; await audio.play(); showMusicBtn(); } catch(e){ showMusicBtn(); } }
    document.addEventListener('WeixinJSBridgeReady', function(){ try{ audio.muted=false; audio.play(); }catch(e){} showMusicBtn(); }, false);
    let unlocked=false;
    const unlockWin=['scroll','wheel'];
    const unlockDoc=['pointerdown','touchstart','touchend','click','keydown'];
    async function unlockAndPlay(){ if(unlocked) return; unlocked=true; try{ audio.muted=false; if(audio.paused) await audio.play(); } finally{ removeUnlockers(); showMusicBtn(); } }
    function addUnlockers(){ unlockWin.forEach(t=>window.addEventListener(t,unlockAndPlay,{passive:true})); unlockDoc.forEach(t=>document.addEventListener(t,unlockAndPlay,{passive:true})); }
    function removeUnlockers(){ unlockWin.forEach(t=>window.removeEventListener(t,unlockAndPlay)); unlockDoc.forEach(t=>document.removeEventListener(t,unlockAndPlay)); }
    musicBtn.addEventListener('click', async ()=>{ try{ if(audio.paused){ audio.muted=false; await audio.play(); } else { audio.pause(); } } finally{ showMusicBtn(); } });
    document.addEventListener('DOMContentLoaded', ()=>{ tryAutoplaySilently(); addUnlockers(); });
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden && audio.paused && !unlocked){ tryAutoplaySilently(); } });

    /* ========= å€’è®¡æ—¶ ========= */
    const cd=document.getElementById('countdown');
    if(cd){
      const ds=cd.dataset.deadline||'2025-12-10T18:00:00';
      const target=new Date(ds);
      const dEl=document.getElementById('cd-days');
      const hEl=document.getElementById('cd-hours');
      const mEl=document.getElementById('cd-mins');
      const sEl=document.getElementById('cd-secs');
      const pad=n=>n<10?('0'+n):(''+n);
      function tick(){
        const now=new Date(); let diff=Math.max(0, target-now);
        const days=Math.floor(diff/86400000); diff-=days*86400000;
        const hours=Math.floor(diff/3600000); diff-=hours*3600000;
        const mins=Math.floor(diff/60000); diff-=mins*60000;
        const secs=Math.floor(diff/1000);
        dEl.textContent=pad(days); hEl.textContent=pad(hours); mEl.textContent=pad(mins); sEl.textContent=pad(secs);
      }
      tick(); setInterval(tick,1000);
    }

    /* ========= ç•™è¨€æ¿ + å¼¹å¹• ========= */
    const dmLayer=document.getElementById('danmu-layer');
    const dmBtn=document.getElementById('dm-toggle');
    const danmu={
      enabled:true, queue:[], idx:0, timer:null,
      intervalMs:1600, trackH:28,
      get trackCount(){ return window.innerWidth<768?4:6; },
      start(){ if(this.timer||!this.queue.length) return; this.timer=setInterval(()=>this.fire(), this.intervalMs); dmBtn.textContent='ğŸ’¬'; },
      stop(){ if(this.timer){ clearInterval(this.timer); this.timer=null; } dmBtn.textContent='ğŸš«'; },
      setEnabled(v){ this.enabled=v; if(v) this.start(); else this.stop(); },
      setMessages(msgs){ this.queue=(Array.isArray(msgs)?msgs:[]).filter(s=>s&&s.trim().length>0); this.idx=0; if(this.enabled&&this.queue.length) this.start(); },
      nextMsg(){ if(!this.queue.length) return ''; const t=this.queue[this.idx%this.queue.length]; this.idx++; return t; },
      fire(){
        if(!this.enabled||!this.queue.length) return;
        const text=this.nextMsg(); if(!text) return;
        const el=document.createElement('span'); el.className='dm'; el.textContent=text;
        const track=Math.floor(Math.random()*this.trackCount);
        el.style.top = Math.round(track*this.trackH + (this.trackH/4)) + 'px';
        const base = window.innerWidth<768 ? 10 : 12;
        const dur  = Math.max(8, Math.min(16, base + Math.min(text.length, 40)*0.15));
        el.style.animationDuration = dur + 's';
        el.addEventListener('animationend', ()=>el.remove());
        dmLayer.appendChild(el);
      }
    };
    dmBtn.addEventListener('click', ()=> danmu.setEnabled(!danmu.enabled) );

    (function(){
      const form   = document.getElementById('rsvp-form');
      const nameI  = document.getElementById('rsvp-name');
      const countI = document.getElementById('rsvp-count');
      const msgI   = document.getElementById('rsvp-msg');
      const listEl = document.getElementById('rsvp-list');
      const statusEl = document.getElementById('rsvp-status');

      function render(listData){
        if(!Array.isArray(listData)||!listData.length){
          listEl.innerHTML = '<li style="padding:12px 14px;border:1px solid rgba(0,0,0,.06);border-radius:12px;color:#666;text-align:center;">æš‚æ— ç•™è¨€</li>';
          return;
        }
        listEl.innerHTML = listData.map(item=>{
          const t=new Date(item.createdAt||Date.now());
          const d=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')} ${String(t.getHours()).padStart(2,'0')}:${String(t.getMinutes()).padStart(2,'0')}`;
          const msg=(item.message||'').replace(/</g,'&lt;').replace(/>/g,'&gt;');
          return `
            <li style="padding:12px 14px;border:1px solid rgba(0,0,0,.06);border-radius:12px;background:#fff;">
              <div style="font-weight:700;">${item.name} <span style="font-weight:400;opacity:.7;">ï¼ˆ${item.count}äººï¼‰</span></div>
              ${msg?`<div style="margin-top:4px;">${msg}</div>`:''}
              <div style="margin-top:6px;font-size:12px;opacity:.6;">${d}</div>
            </li>`;
        }).join('');
      }

      async function loadList(){
        try{
          const res = await fetch('/api/rsvp/list', { cache:'no-store' });
          const data = await res.json();
          render(data);
          const msgs = Array.isArray(data) ? data.map(x=>(x.message||'').trim()).filter(Boolean) : [];
          danmu.setMessages(msgs);     // é»˜è®¤å¼€å¯ + å¾ªç¯æ’­æ”¾
          statusEl.textContent='';
        }catch(e){
          statusEl.textContent='åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
        }
      }

      form?.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const payload={
          name:nameI.value.trim(),
          count:Number(countI.value||0),
          message:msgI.value.trim()
        };
        if(!payload.name || !payload.count){
          statusEl.textContent='è¯·å¡«å†™å§“åå’Œäººæ•°';
          return;
        }
        try{
          statusEl.textContent='æäº¤ä¸­...';
          const res=await fetch('/api/rsvp/submit', {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body:JSON.stringify(payload)
          });
          const ret=await res.json();
          if(ret.ok){
            statusEl.textContent='æäº¤æˆåŠŸï¼Œå·²æ›´æ–°åˆ—è¡¨';
            form.reset();
            await loadList();
          }else{
            statusEl.textContent='æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•';
          }
        }catch(e){
          statusEl.textContent='ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•';
        }
      });

      loadList();
    })();
  })();
  </script>
</body>
</html>
